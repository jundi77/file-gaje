{"version":3,"sources":["coursecategory.js"],"names":["define","jQuery","bsselect","templates","toolbar","Ajax","filterobj","sortfilter","searchfilter","categoryfilter","coursestab","mycoursestab","coursesregion","mycoursesregion","coursespagination","mycoursespagination","togglebtn","gridtemplate","listtemplate","pageheaderactions","generateCourseCards","isFilterModified","$","show","appendtab","tab","appendpagination","call","methodname","args","data","JSON","stringify","done","response","parse","empty","append","viewobj","view","rendertemplate","window","screen","width","addClass","removeClass","courses","length","i","render","then","html","js","appendNodeContents","each","this","content","style","fail","ex","htmldata","pagination","hide","err","getCourses","CategoryFilters","_pageobj","mycourses","_obj","category","sort","search","page","initAttributes","initPagination","updatePage","destroytab","destroypagination","destroyCourseCards","document","ready","hash","vars","hashes","location","href","slice","indexOf","split","push","undefined","hasClass","filterdata","selectpicker","val","generateFilters","delegate","attr","on","e","target","value","preventDefault","clckviewbtn","M","util","set_user_preference","linkdata","parentElement"],"mappings":"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","sourcesContent":["define(['jquery', 'theme_remui/bootstrap-select', 'core/templates', 'theme_remui/jquery-toolbar', 'core/ajax'], function(jQuery, bsselect, templates, toolbar, Ajax) {\n\n    // Globals\n    var filterobj;\n\n    // Filter selectors\n    var sortfilter = jQuery('select#sortfilter.selectpicker');\n    var viewfilter = jQuery('.togglebtn');\n    var searchfilter   = jQuery('#coursesearch2');\n    var categoryfilter = jQuery('select#categoryfilter.selectpicker');\n\n    // Tab selector\n    var tabsselector = jQuery(\".nav-tabs .nav-item\");\n    var coursestab   = jQuery('#coursestab');\n    var mycoursestab = jQuery('#mycoursestab');\n\n    // Courses Region Selector\n    var coursesregion   = jQuery('#coursesregion div.content');\n    var mycoursesregion = jQuery('#mycoursesregion div.content');\n\n    // Pagination Selector\n    var coursespagination   = jQuery('#coursespagination');\n    var mycoursespagination = jQuery('#mycoursespagination');\n\n    // View toggler\n    var togglebtn = jQuery(\".togglebtn\");\n\n\n    // view templates\n    var gridtemplate = 'theme_remui/course_card_grid';\n    var listtemplate = 'theme_remui/course_card_list';\n\n    var pageheaderactions = '.page-header-actionss';\n\n\n    // Initialization of courses\n    jQuery(document).ready(function (){\n\n        filterobj = new CategoryFilters(); // Global object for filters\n        // filterobj.initAttributes(); // Initialize global filter object with default values\n\n        var vars = [], hash;\n        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');\n        for(var i = 0; i < hashes.length; i++)\n        {\n            hash = hashes[i].split('=');\n            vars.push(hash[0]);\n            vars[hash[0]] = hash[1];\n        }\n\n        if (vars['categoryid'] && vars['categoryid'] != 0) {\n            filterobj.category = vars['categoryid'];\n        }\n\n        if (vars['categorysort'] != undefined) {\n            filterobj.sort = vars['categorysort'];\n        }\n\n        if (vars['search'] != undefined) {\n            filterobj.search = vars['search'];\n        }\n\n        if(vars['mycourses'] && vars['mycourses'] != 0)\n        {\n            filterobj.tab = true;\n            if ($(\"body\").hasClass(\"notloggedin\")) {\n                filterobj.tab = false;\n            }\n        }\n        generateFilters(filterobj); // This will create filters\n        generateCourseCards(); // Course cards Generation\n    });\n\n\n    // Filters Generation\n    function generateFilters(filterdata)\n    {\n        jQuery( \".selectpicker\" ).each(function() {\n            jQuery(this).selectpicker();\n        });\n\n        if (filterdata.category != \"0\") {\n           jQuery(\"#categoryfilter.selectpicker\").selectpicker('val', filterdata.category);\n        }\n\n        if (filterdata.sort != null) {\n           jQuery(\"#sortfilter.selectpicker\").selectpicker('val', filterdata.sort);\n        }\n\n        if (filterdata.sort != \"\") {\n           jQuery(\"#coursesearchbox\").val(filterdata.search);\n        }\n\n        // Put animation over here\n        jQuery(\".category-filters\").removeClass('d-none');\n    }\n\n    // Course cards initialization function\n    function generateCourseCards()\n    {\n        // Check if Filters are modified and need to fetch the courses\n        if(!filterobj.isFilterModified){\n            return;\n        }\n        // Fetch the courses\n        getCourses();\n    }\n\n    function destroyCourseCards()\n    {\n        // Find active tab to append the course cards\n        var destroytab = (filterobj.tab) ? mycoursesregion : coursesregion;\n        // Empty the courses region\n        jQuery(destroytab).empty();\n\n        // Destroy the pagination also\n        if(filterobj.pagination){\n            var destroypagination = (filterobj.tab) ? mycoursespagination : coursespagination;\n            jQuery(destroypagination).empty();\n        }\n\n    }\n\n    // Main category filters class\n    function CategoryFilters() {\n\n        var _pageobj = {courses: 0, mycourses: 0};\n        var _obj = {\n            category:\"all\", // Category id\n            sort: null, // Sorting\n            search:\"\", // Searching string\n            tab : false, // if true, means mycourses tab is active\n            page: _pageobj, // This object consist of page number that is currently active, has mycourses and all courses tab page number\n            pagination :true, // if True, regenerate the pagination on any action performed\n            view : null, // initially it is null to detect initial change in view, String grid - view in grid format, String list - list format\n            isFilterModified: true  // This filterModified true will tell that we need to fetch the courses otherwise show old fetched data, \n        };\n\n        _obj.initAttributes = function(){\n            _obj.category = 'all';\n            _obj.sort = null;\n            _obj.search = '';\n            _obj.tab = false;\n            _obj.page = _pageobj;\n            _obj.pagination = true;\n            _obj.view = null;\n            _obj.isFilterModified = true;\n        }\n\n        _obj.initPagination = function(){\n            _obj.page = {courses: 0, mycourses: 0};\n        }\n        return _obj;\n    }\n\n    // Ajax to fetch the course\n    // and also append those courses to the page\n    // if pagination is enabled it will also generate new pagination\n    function getCourses() {\n        $('.courses-tabs .courses-loader-wrap').show();\n        // Find active tab to append the course cards\n        var appendtab = (filterobj.tab) ? mycoursesregion : coursesregion;\n        var appendpagination = (filterobj.tab) ? mycoursespagination : coursespagination;\n        var  service_name = 'theme_remui_get_courses';\n        var getcourses = Ajax.call([\n            {\n                methodname: service_name,\n                args: {\n                    data: JSON.stringify(filterobj)\n                }\n            }\n        ]);\n        getcourses[0].done(function(response) {\n            response = JSON.parse(response);\n            jQuery(pageheaderactions).empty();\n            if (response['hasmanagebutton'] == true) {\n                jQuery(pageheaderactions).append(response['managebuttons']);\n            }\n\n            // Get the view\n            var viewobj = (filterobj.view == null)?response['view'] : filterobj.view;\n\n            // Select the template to render according to view\n            var rendertemplate = (viewobj == 'grid' || response['latest_card'])? gridtemplate : listtemplate;\n\n            // always render grid teplate on mobile screen and when latest cards setting is on\n            if (window.screen.width <= 480 || response['latest_card']) {\n                rendertemplate = gridtemplate ;\n                viewobj = 'grid'\n            }\n\n            // update the view\n            updateView(viewobj);\n\n            updateCards(response['latest_card']);\n\n            var courses = response['courses'];\n    \n            if (courses.length > 0) {\n                for (var i = 0; i < courses.length; i++) {\n                    // This will call the function to load and render our template.\n                    templates.render(rendertemplate, courses[i])\n                    // It returns a promise that needs to be resoved.\n                    .then(function(html, js) {\n                        // Here eventually I have my compiled template, and any javascript that it generated.\n                        // The templates object has append, prepend and replace functions.\n                        templates.appendNodeContents(appendtab, html, js);\n\n                        // Show options button on course card\n                        // check if not mycourse tab\n                        // This is very bad code, couldn't do it another way,\n                        // it get called each time a single card is added to dom, try to improve it\n                        if (!filterobj.tab && !response['latest_card']) {\n                            jQuery('.showoptions').each(function(){\n                                jQuery(this).toolbar({\n                                    content: jQuery(this).data('toolbar'),\n                                    style: 'primary'\n                                });\n                            });\n                        }\n                    }).fail(function(ex) {\n                        // Deal with this exception (I recommend core/notify exception function for this).\n                    });\n                }\n\n            } else {\n                var htmldata = '<div class=\"alert alert-warning alert-dismissible  w-full mx-10\" role=\"alert\">';\n                htmldata += '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">×</span><span class=\"sr-only\">Close</span></button> No Courses Found</div>';\n                templates.appendNodeContents(appendtab, htmldata, '');\n\n            }\n\n            // Pagination html\n            // Check if pagination is enabled\n            if(filterobj.pagination) {\n                templates.appendNodeContents(appendpagination, response['pagination'], '');\n            }\n            jQuery('.courses-tabs .courses-loader-wrap').hide();\n        }).fail(function (err) {\n            jQuery('.courses-tabs .courses-loader-wrap').show();\n        });\n    }\n\n\n    // ***************** Actions ***************************\n\n    // This is for, Toolbar redirection not working\n    jQuery(document).delegate('.tool-item', 'click', function () {\n        window.location = jQuery(this).attr('href');\n    });\n\n    // Category filter \n    jQuery(categoryfilter).on('changed.bs.select', function (e) {\n        filterobj.category   = e.target.value;\n        filterobj.initPagination();\n        updatePage();\n    });\n    // Sorting Filter\n    jQuery(sortfilter).on('changed.bs.select', function (e) {\n        filterobj.sort = e.target.value;\n        updatePage();\n    });\n    // Course Tab Selector\n    jQuery(coursestab).on('click', function(){\n        filterobj.tab = false;\n        updatePage();\n    });\n    // My Course Tab Selector\n    jQuery(mycoursestab).on('click', function(){\n        filterobj.tab = true;\n        updatePage();\n    });\n\n    // Search Filter\n    jQuery(searchfilter).on('submit', function(e){\n        e.preventDefault();\n        filterobj.initPagination();\n        filterobj.search = jQuery('#coursesearchbox').val();\n        updatePage();\n    });\n\n    // View toggler\n    jQuery(togglebtn).on('click', function(){\n        var clckviewbtn = jQuery(this).attr('data-view');\n        filterobj.view = clckviewbtn;\n        M.util.set_user_preference('course_view_state', clckviewbtn, null);\n        updatePage();\n    });\n\n    // This function is commented because no one is going to resize the screen\n\n    // jQuery(window).resize(function(){\n    //     // filterobj.initPagination();\n    //     updatePage();\n    // });\n\n    function updateView(view){\n        if(view == 'grid'){\n            filterobj.view = 'grid';\n            jQuery('.tab-content').addClass('grid-view').removeClass('list-view');\n            jQuery('.grid_btn').addClass('btn-primary active');\n            jQuery('.list_btn').removeClass('btn-primary active');\n        } else {\n            filterobj.view = 'list';\n            jQuery('.tab-content').addClass('list-view').removeClass('grid-view');\n            jQuery('.grid_btn').removeClass('btn-primary active');\n            jQuery('.list_btn').addClass('btn-primary active');\n        }\n    }\n\n    function updateCards(latest){\n        if(latest){\n            jQuery('.tab-content').addClass('latest-cards');\n            jQuery('.viewtoggler').addClass('hidden');\n        } else {\n            jQuery('.tab-content').removeClass('latest-cards');\n            jQuery('.viewtoggler').removeClass('hidden');\n        }\n    }\n\n    // Pagination Click Event\n    jQuery(document).delegate('.tab-pane .pagination .page-item .page-link', 'click',function(e){\n        e.preventDefault();\n        // Update the page number in object for mycourses as well as all courses tab\n        var linkdata = e.target.href;\n        if( linkdata === undefined ) {\n            linkdata = e.target.parentElement.href;\n            if(linkdata === undefined){\n                linkdata = e.target.parentElement.parentElement.href;\n            }\n        }\n\n        var hashes = linkdata.slice(linkdata.indexOf('?') + 1).split('&');\n        var vars = [], hash;\n        for(var i = 0; i < hashes.length; i++)\n        {\n            hash = hashes[i].split('=');\n            vars.push(hash[0]);\n            vars[hash[0]] = hash[1];\n        }\n\n        if(filterobj.tab){\n            filterobj.page.mycourses = vars['page'];\n        }else{\n            filterobj.page.courses = vars['page'];\n        }\n\n        updatePage();\n    });\n\n    function updatePage()\n    {\n        // Destroy the cards from page\n        destroyCourseCards();\n        // Create courses cards again\n        generateCourseCards();\n    }\n\n});\n\n"],"file":"coursecategory.min.js"}